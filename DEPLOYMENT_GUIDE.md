# üöÄ Complete Deployment Guide - bengalurutenants.in

**Last Updated:** October 5, 2025  
**Status:** Ready for Deployment ‚úÖ

---

## üìã Table of Contents

1. [Pre-Deployment Checklist](#pre-deployment-checklist)
2. [Deploy Backend to Render](#deploy-backend-to-render)
3. [Deploy Frontend to Vercel](#deploy-frontend-to-vercel)
4. [Environment Variables Setup](#environment-variables-setup)
5. [Custom Domain Configuration](#custom-domain-configuration)
6. [Post-Deployment Testing](#post-deployment-testing)
7. [Future Updates Workflow](#future-updates-workflow)
8. [Troubleshooting](#troubleshooting)

---

## ‚úÖ Pre-Deployment Checklist

Before deploying, make sure you have:

- [ ] GitHub account with repository access
- [ ] Supabase account with database URL
- [ ] Cloudflare R2 credentials (already in code)
- [ ] SMTP2GO or Gmail credentials for email
- [ ] Google Maps API key (already in code)
- [ ] Custom domain purchased (optional, can add later)

**Code Preparation (Already Done ‚úÖ):**
- [x] Fixed all hardcoded localhost URLs
- [x] Created `vercel.json` for frontend
- [x] Created `render.yaml` for backend
- [x] Created `.env.production` templates

---

## üîß Step 1: Deploy Backend to Render

### **1.1 Sign Up for Render**

1. Go to [render.com](https://render.com)
2. Click **Get Started for Free**
3. Sign up with GitHub (recommended)
4. Authorize Render to access your repositories

### **1.2 Create Web Service**

1. Click **New** ‚Üí **Web Service**
2. Connect your `bengalurutenants.in` repository
3. Render will auto-detect `render.yaml`
4. Configure the service:
   - **Name:** `bengalurutenants-api`
   - **Region:** Singapore (closest to Bangalore)
   - **Branch:** `main`
   - **Root Directory:** Leave empty
   - **Runtime:** Python 3
   - **Build Command:** (auto-filled from render.yaml)
   - **Start Command:** (auto-filled from render.yaml)

5. Click **Create Web Service**

### **1.3 Set Environment Variables**

Once the service is created, go to **Environment** tab and add:

**Required Variables:**

```env
# Database (Supabase)
DATABASE_URL=postgresql://postgres.[your-project-ref]:[password]@aws-0-[region].pooler.supabase.com:6543/postgres

# Authentication (SECRET_KEY auto-generated by Render)
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_HOURS=168
MAGIC_TOKEN_EXPIRE_SECONDS=600

# Frontend URL (temporary - update after Vercel deployment)
FRONTEND_URL=http://localhost:3000

# Environment
ENVIRONMENT=production
DEBUG=false

# Cloudflare R2 Storage (ALREADY WORKING)
R2_ACCESS_KEY_ID=ee7887627988aeca68e32f102430e269
R2_SECRET_ACCESS_KEY=c64c79fe9e5f8011bcebd4349696f8b12d5377e2bf0e5759cd94ac28d9de061a
R2_ENDPOINT=https://e50c8ae0180a83ebf4bc87687b15fe27.r2.cloudflarestorage.com
R2_BUCKET=tenant-review-photos

# Email Service (SMTP2GO or Gmail)
MAIL_USERNAME=[your-smtp-username]
MAIL_PASSWORD=[your-smtp-password]
MAIL_FROM=noreply@yourdomain.com
MAIL_SERVER=mail.smtp2go.com
MAIL_PORT=587

# Google Maps API (ALREADY WORKING)
GOOGLE_MAPS_API_KEY=AIzaSyDFJf8xF1HeZO68GWFGmIUyPRSeNhCGJ2s

# Python Version
PYTHON_VERSION=3.11 
```

**‚ö†Ô∏è Important:** After adding variables, click **Save Changes** and the service will redeploy.

### **1.4 Get Backend URL**

After deployment completes (2-3 minutes):
- Your backend will be live at: `https://bengalurutenants-api.onrender.com`
- Test it: `https://bengalurutenants-api.onrender.com/health`

**Copy this URL - you'll need it for Vercel!**

---

## üé® Step 2: Deploy Frontend to Vercel

### **2.1 Sign Up for Vercel**

1. Go to [vercel.com](https://vercel.com)
2. Click **Sign Up**
3. Sign up with GitHub (recommended)
4. Authorize Vercel to access your repositories

### **2.2 Import Project**

1. Click **Add New** ‚Üí **Project**
2. Select `bengalurutenants.in` repository
3. Configure import settings:
   - **Framework Preset:** Next.js (auto-detected)
   - **Root Directory:** `frontend`
   - **Build Command:** `npm run build` (auto-filled)
   - **Output Directory:** `.next` (auto-filled)
   - **Install Command:** `npm install` (auto-filled)

### **2.3 Add Environment Variables**

Before clicking Deploy, add these environment variables:

```env
NEXT_PUBLIC_API_URL=https://bengalurutenants-api.onrender.com
NEXT_PUBLIC_GOOGLE_MAPS_API_KEY=AIzaSyDFJf8xF1HeZO68GWFGmIUyPRSeNhCGJ2s
```

**Replace `bengalurutenants-api.onrender.com` with your actual Render URL from Step 1.4**

### **2.4 Deploy**

1. Click **Deploy**
2. Wait 2-3 minutes for build to complete
3. You'll get a URL like: `https://bengalurutenants-in-xyz123.vercel.app`

### **2.5 Update Backend FRONTEND_URL**

Go back to Render dashboard:
1. Go to your `bengalurutenants-api` service
2. Click **Environment** tab
3. Update `FRONTEND_URL` to your Vercel URL: `https://bengalurutenants-in-xyz123.vercel.app`
4. Click **Save Changes** (service will redeploy)

---

## üîê Step 3: Detailed Environment Variables Guide

### **Frontend (Vercel) Environment Variables:**

| Variable | Value | Purpose |
|----------|-------|---------|
| `NEXT_PUBLIC_API_URL` | `https://bengalurutenants-api.onrender.com` | Backend API endpoint |
| `NEXT_PUBLIC_GOOGLE_MAPS_API_KEY` | `AIzaSyDFJf8xF1HeZO68GWFGmIUyPRSeNhCGJ2s` | Google Maps integration |

### **Backend (Render) Environment Variables:**

| Variable | Value | Where to Get |
|----------|-------|--------------|
| `DATABASE_URL` | `postgresql://...` | Supabase ‚Üí Settings ‚Üí Database ‚Üí Connection String (Pooling) |
| `SECRET_KEY` | Auto-generated | Render auto-generates |
| `FRONTEND_URL` | `https://yourdomain.com` | Your Vercel URL |
| `R2_ACCESS_KEY_ID` | `ee7887627988aeca68e32f102430e269` | Already in code ‚úÖ |
| `R2_SECRET_ACCESS_KEY` | `c64c79fe9e5f8011bcebd4349696f8b12d5377e2bf0e5759cd94ac28d9de061a` | Already in code ‚úÖ |
| `R2_ENDPOINT` | `https://e50c8ae0180a83ebf4bc87687b15fe27.r2.cloudflarestorage.com` | Already in code ‚úÖ |
| `R2_BUCKET` | `tenant-review-photos` | Already in code ‚úÖ |
| `MAIL_USERNAME` | Your SMTP username | SMTP2GO or Gmail |
| `MAIL_PASSWORD` | Your SMTP password | SMTP2GO or Gmail |
| `MAIL_FROM` | `noreply@yourdomain.com` | Your email |
| `MAIL_SERVER` | `mail.smtp2go.com` or `smtp.gmail.com` | Email provider |
| `GOOGLE_MAPS_API_KEY` | `AIzaSyDFJf8xF1HeZO68GWFGmIUyPRSeNhCGJ2s` | Already in code ‚úÖ |

### **Getting Supabase DATABASE_URL:**

1. Go to [supabase.com](https://supabase.com)
2. Sign in and select your project
3. Go to **Settings** ‚Üí **Database**
4. Scroll to **Connection String**
5. Choose **Connection Pooling** tab (important for Render!)
6. Copy the URI mode connection string
7. Replace `[YOUR-PASSWORD]` with your actual password

Example format:
```
postgresql://postgres.abcdefgh:password@aws-0-us-west-1.pooler.supabase.com:6543/postgres
```

### **Getting SMTP2GO Credentials:**

**Option 1: SMTP2GO (Recommended - 1000 free emails/month)**

1. Go to [smtp2go.com](https://smtp2go.com)
2. Sign up for free account
3. Verify your domain or use their sender
4. Go to **Settings** ‚Üí **SMTP Users**
5. Create new SMTP user
6. Copy username and password

```env
MAIL_SERVER=mail.smtp2go.com
MAIL_PORT=587
MAIL_USERNAME=your-smtp2go-username
MAIL_PASSWORD=your-smtp2go-password
```

**Option 2: Gmail (Use App Password)**

1. Enable 2FA on your Google account
2. Go to [Google App Passwords](https://myaccount.google.com/apppasswords)
3. Create app password for "Mail"
4. Copy the 16-character password

```env
MAIL_SERVER=smtp.gmail.com
MAIL_PORT=587
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=your-16-char-app-password
```

---

## üåê Step 4: Custom Domain Setup (Optional)

### **4.1 Add Domain to Vercel (Frontend)**

1. Buy domain from Namecheap, GoDaddy, etc.
2. In Vercel dashboard ‚Üí Your project ‚Üí **Settings** ‚Üí **Domains**
3. Add your domain: `yourdomain.com` and `www.yourdomain.com`
4. Vercel will show DNS records to add:

```
Type: A
Name: @
Value: 76.76.21.21

Type: CNAME  
Name: www
Value: cname.vercel-dns.com
```

5. Go to your domain registrar's DNS settings
6. Add these records
7. Wait 5-30 minutes for propagation
8. Vercel will auto-provision SSL certificate

### **4.2 Add Custom Domain to Render (Backend)**

1. In Render dashboard ‚Üí Your service ‚Üí **Settings** ‚Üí **Custom Domains**
2. Add: `api.yourdomain.com`
3. Render will show a CNAME record:

```
Type: CNAME
Name: api
Value: bengalurutenants-api.onrender.com
```

4. Go to your domain registrar's DNS settings
5. Add this record
6. Wait 5-30 minutes for propagation
7. Render will auto-provision SSL certificate

### **4.3 Update Environment Variables**

After domain setup:

**In Vercel:**
- No change needed (NEXT_PUBLIC_API_URL already set)

**In Render:**
- Update `FRONTEND_URL` to: `https://yourdomain.com`
- Update `MAIL_FROM` to: `noreply@yourdomain.com`

---

## ‚úÖ Step 5: Post-Deployment Testing

### **5.1 Test Backend Health**

```bash
curl https://bengalurutenants-api.onrender.com/health
```

Expected response:
```json
{
  "status": "healthy",
  "timestamp": "2025-10-05T...",
  "environment": "production"
}
```

### **5.2 Test Frontend**

1. Visit your Vercel URL: `https://bengalurutenants-in-xyz123.vercel.app`
2. Check homepage loads
3. Check search works
4. Check images display

### **5.3 Test Authentication Flow**

1. Click **Login** button
2. Enter your email
3. Check email received (SMTP2GO or Gmail)
4. Click magic link
5. Verify logged in successfully

### **5.4 Test Photo Upload**

1. Login
2. Add new review with photo
3. Verify photo uploads to Cloudflare R2
4. Verify photo displays in property card

### **5.5 Test Guest Access**

1. Open incognito/private window
2. Visit your site
3. Verify you can:
   - Search properties
   - View property cards
   - See property images
   - Read reviews
4. Verify you cannot:
   - Add reviews
   - Upload photos

---

## üîÑ Step 6: Future Updates Workflow

### **Making Frontend Changes:**

```bash
# 1. Make changes locally
cd frontend
code src/components/YourComponent.tsx

# 2. Test locally
npm run dev  # http://localhost:3000

# 3. Commit and push
git add .
git commit -m "feat: update homepage UI"
git push origin main

# 4. Vercel auto-deploys in ~2 minutes! ‚úÖ
```

### **Making Backend Changes:**

```bash
# 1. Make changes locally
cd backend
code app/routers/your_router.py

# 2. Test locally
python main.py  # http://localhost:8000

# 3. Commit and push
git add .
git commit -m "feat: add new API endpoint"
git push origin main

# 4. Render auto-deploys in ~3 minutes! ‚úÖ
```

### **Database Schema Changes:**

```bash
# 1. Update models
cd backend
code app/models.py

# 2. Create migration
alembic revision --autogenerate -m "add_new_field"

# 3. Test locally
alembic upgrade head

# 4. Commit and push
git add .
git commit -m "db: add new field to properties table"
git push origin main

# 5. Render auto-deploys and runs migrations ‚úÖ
```

### **Environment Variable Updates:**

**Frontend (Vercel):**
1. Go to Vercel ‚Üí Project ‚Üí **Settings** ‚Üí **Environment Variables**
2. Edit variable
3. Click **Save**
4. Go to **Deployments** ‚Üí Click ‚ãØ ‚Üí **Redeploy**

**Backend (Render):**
1. Go to Render ‚Üí Service ‚Üí **Environment**
2. Edit variable
3. Click **Save Changes** (auto-redeploys)

---

## üêõ Step 7: Troubleshooting

### **Backend Not Connecting to Supabase:**

**Symptom:** Database connection errors

**Fix:**
1. Check `DATABASE_URL` is correct (use Connection Pooling URL)
2. In Supabase ‚Üí Settings ‚Üí Database ‚Üí Connection Pooling
3. Add Render IP to allowed connections (or use `0.0.0.0/0` for simplicity)

### **CORS Errors:**

**Symptom:** Frontend can't connect to backend API

**Fix:**
1. Go to Render ‚Üí Environment
2. Update `FRONTEND_URL` to your actual Vercel URL
3. Save (triggers redeploy)

### **Email Not Sending:**

**Symptom:** Magic links not received

**Fix:**
1. Check SMTP credentials are correct
2. For Gmail: Use App Password (not regular password)
3. For SMTP2GO: Verify domain or use their sender
4. Check Render logs: **Logs** tab ‚Üí Look for email errors

### **Images Not Loading:**

**Symptom:** Property images show fallback

**Fix:**
1. Check Cloudflare R2 credentials in Render Environment
2. Verify R2 bucket is public or accessible
3. Check browser console for CORS errors

### **Cold Start Delays:**

**Symptom:** First request after 15 mins takes 30-60 seconds

**This is normal for Render free tier!**

Options:
- Upgrade to Render paid plan ($7/month) for no cold starts
- Use UptimeRobot to ping API every 10 minutes (keeps it warm)
- Accept the trade-off (free hosting)

### **Build Failures:**

**Frontend (Vercel):**
1. Check build logs in Vercel dashboard
2. Ensure `frontend/package.json` has all dependencies
3. Run `npm run build` locally first

**Backend (Render):**
1. Check build logs in Render dashboard
2. Ensure `backend/requirements.txt` is complete
3. Check Python version matches (3.11)

---

## üìä Free Tier Limits Summary

| Service | Free Tier | Your Usage | Status |
|---------|-----------|------------|--------|
| **Vercel** | 100GB bandwidth | ~5-10GB/month | ‚úÖ Safe |
| **Render** | 750 hours/month | ~720 hours (24/7) | ‚úÖ Safe |
| **Supabase** | 500MB database + 1GB bandwidth | ~50MB + minimal | ‚úÖ Safe |
| **Cloudflare R2** | 10GB storage + 10M requests | ~1-2GB + low requests | ‚úÖ Safe |
| **SMTP2GO** | 1000 emails/month | ~100-200/month | ‚úÖ Safe |
| **Google Maps** | $200 credit/month | ~$10-20/month | ‚úÖ Safe |

**Total Monthly Cost:** $0 (except domain ~$1/month)

---

## üéØ Quick Reference Commands

### **Local Development:**

```bash
# Frontend
cd frontend
npm run dev

# Backend
cd backend
python main.py

# Database migrations
cd backend
alembic upgrade head
```

### **Deployment:**

```bash
# Deploy everything
git add .
git commit -m "your changes"
git push origin main
# Both Vercel and Render auto-deploy! ‚úÖ
```

### **Testing:**

```bash
# Test backend health
curl https://your-backend.onrender.com/health

# Test API endpoint
curl https://your-backend.onrender.com/api/v1/properties/

# Check backend logs
# Go to Render dashboard ‚Üí Logs tab
```

---

## üìû Support Resources

### **Documentation:**
- Vercel Docs: [vercel.com/docs](https://vercel.com/docs)
- Render Docs: [render.com/docs](https://render.com/docs)
- Supabase Docs: [supabase.com/docs](https://supabase.com/docs)

### **Your Project:**
- **GitHub:** https://github.com/RudraKhare/bengalurutenants.in
- **Frontend:** https://your-site.vercel.app
- **Backend:** https://your-api.onrender.com
- **API Docs:** https://your-api.onrender.com/docs

---

## üéâ Deployment Checklist

Use this to track your progress:

- [ ] Render account created
- [ ] Backend deployed to Render
- [ ] Backend environment variables set
- [ ] Backend health check passing
- [ ] Vercel account created
- [ ] Frontend deployed to Vercel
- [ ] Frontend environment variables set
- [ ] Frontend loads successfully
- [ ] CORS configured (FRONTEND_URL updated)
- [ ] Supabase database connected
- [ ] Email service working (SMTP2GO/Gmail)
- [ ] Cloudflare R2 images loading
- [ ] Google Maps displaying
- [ ] Authentication flow tested
- [ ] Guest access verified
- [ ] Custom domain added (optional)
- [ ] DNS records configured (optional)
- [ ] SSL certificates active

---

## üí° Pro Tips

1. **Use Connection Pooling:** Always use Supabase's connection pooling URL for Render
2. **Environment Variables:** Keep sensitive data in platform dashboards, never in code
3. **Monitor Logs:** Check Render logs regularly for errors
4. **Test Before Merge:** Always test locally before pushing to main
5. **Backup Database:** Export Supabase data regularly
6. **API Rate Limits:** Google Maps has generous free tier but monitor usage
7. **Cold Starts:** Consider UptimeRobot to ping API every 10 mins if needed
8. **SSL Auto-Renewal:** Vercel and Render handle this automatically

---

**Document Version:** 1.0  
**Last Updated:** October 5, 2025  
**Status:** Production Ready ‚úÖ

